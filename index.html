<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Fórum Anônimo</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      display: flex;
      background: #f4f4f4;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: #1e1e1e;
      color: white;
    }
    .container {
      display: flex;
      width: 100%;
    }
    .sidebar {
      width: 250px;
      background: #ddd;
      padding: 10px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      transition: background 0.3s;
    }
    body.dark .sidebar {
      background: #2c2c2c;
    }
    .sidebar input {
      width: 100%;
      padding: 5px;
      margin-bottom: 10px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      cursor: pointer;
      padding: 5px;
    }
    .sidebar li:hover {
      background: #bbb;
    }
    body.dark .sidebar li:hover {
      background: #444;
    }
    .content {
      flex: 1;
      padding: 20px;
    }
    #postForm {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 30px;
    }
    #postForm input, #postForm select, #postForm textarea {
      padding: 8px;
      font-size: 14px;
      width: 100%;
    }
    #postForm button {
      padding: 10px;
      background: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    .post {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      color: black;
    }
    body.dark .post {
      background: #2e2e2e;
      color: white;
    }
    .post-img {
      max-width: 100%;
      margin-top: 10px;
    }
    .comentario-textarea {
      width: 100%;
      margin-top: 10px;
      padding: 6px;
    }
    .views {
      font-size: 12px;
      color: gray;
    }
    .modal {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      background: white;
      padding: 20px;
      border-radius: 5px;
      display: none;
      z-index: 999;
    }
    body.dark .modal {
      background: #2e2e2e;
      color: white;
    }
    .modal label {
      display: block;
      margin: 10px 0 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <input type="text" id="search" placeholder="Pesquisar...">
      <h3 id="temasTitulo">Temas</h3>
      <ul id="temaList">
        <li onclick="filtrarPorTema('Geral')">Geral</li>
        <li onclick="filtrarPorTema('Tecnologia')">Tecnologia</li>
        <li onclick="filtrarPorTema('Música')">Música</li>
        <li onclick="filtrarPorTema('Jogos')">Jogos</li>
        <li onclick="filtrarPorTema('Notícias')">Notícias</li>
        <li onclick="filtrarPorTema('Aleatório')">Aleatório</li>
      </ul>
      <h3 id="acessadosTitulo">Mais acessados</h3>
      <ul id="maisAcessados"></ul>
      <hr>
      <button onclick="abrirConfiguracoes()">⚙️ Configurações</button>
    </aside>

    <main class="content">
      <h1 id="tituloPrincipal">Fórum Anônimo</h1>
      <form id="postForm">
        <input type="text" id="titulo" placeholder="Título do post" required>
        <select id="tema">
          <option>Geral</option>
          <option>Tecnologia</option>
          <option>Música</option>
          <option>Jogos</option>
          <option>Notícias</option>
          <option>Aleatório</option>
        </select>
        <textarea id="conteudo" placeholder="Escreva aqui..." required></textarea>
        <input type="file" id="imagem">
        <button type="submit" id="botaoPostar">Postar</button>
      </form>
      <div id="posts"></div>
    </main>
  </div>

  <!-- Modal de configurações -->
  <div class="modal" id="modalConfig">
    <h3>Configurações</h3>
    <label for="temaSite">Tema:</label>
    <select id="temaSite">
      <option value="claro">Claro</option>
      <option value="escuro">Escuro</option>
    </select>

    <label for="idioma">Idioma:</label>
    <select id="idioma">
      <option value="pt">Português</option>
      <option value="en">English</option>
    </select>

    <br><br>
    <button onclick="fecharConfiguracoes()">Fechar</button>
  </div>

  <script type="module">
    // Firebase initialization
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyDoGZRT9rS4KCkSP6AV99GDs2gEfdoyAVU",
      authDomain: "kill-ea075.firebaseapp.com",
      databaseURL: "https://kill-ea075-default-rtdb.firebaseio.com",
      projectId: "kill-ea075",
      storageBucket: "kill-ea075.firebasestorage.app",
      messagingSenderId: "961864950723",
      appId: "1:961864950723:web:f5f85735d0fe3eea001376"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const body = document.body;
    let posts = [];

    // Nome anônimo
    let contadorAnonimo = localStorage.getItem("anonID") || 1;
    if (!localStorage.getItem("anonID")) {
      localStorage.setItem("anonID", contadorAnonimo);
    }
    const anonimoNome = "anônimo_" + contadorAnonimo;

    // Buscar posts do Firebase
    function buscarPosts() {
      const dbRef = ref(db, 'posts/');
      get(dbRef).then((snapshot) => {
        if (snapshot.exists()) {
          posts = Object.values(snapshot.val());
          exibirPosts(posts);
        } else {
          console.log("Nenhum dado disponível");
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    buscarPosts();

    // Salvar posts no Firebase
    function salvarPostFirebase(post) {
      const newPostKey = push(ref(db, 'posts')).key;
      set(ref(db, 'posts/' + newPostKey), post);
    }

    document.getElementById("postForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const titulo = document.getElementById("titulo").value;
      const conteudo = document.getElementById("conteudo").value;
      const tema = document.getElementById("tema").value;
      const imagemInput = document.getElementById("imagem");
      const imagemURL = imagemInput.files[0] ? URL.createObjectURL(imagemInput.files[0]) : null;

      const novoPost = {
        id: Date.now(),
        titulo,
        conteudo,
        autor: anonimoNome,
        tema,
        imagem: imagemURL,
        comentarios: [],
        visualizacoes: 0
      };

      posts.unshift(novoPost);
      salvarPostFirebase(novoPost);
      exibirPosts(posts);
      e.target.reset();
    });

    function exibirPosts(lista) {
      const area = document.getElementById("posts");
      area.innerHTML = "";
      lista.forEach(post => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <h2>${post.titulo}</h2>
          <p><strong>${post.autor}</strong> - <em>${post.tema}</em></p>
          <p>${post.conteudo}</p>
          ${post.imagem ? `<img src="${post.imagem}" class="post-img">` : ""}
          <p class="views">Visualizações: ${post.visualizacoes}</p>
          <textarea placeholder="Comentar..." class="comentario-textarea"></textarea>
          <button onclick="comentar(${post.id}, this)">Comentar</button>
          <div class="comentarios">
            ${post.comentarios.map(c => `<p>${c}</p>`).join("")}
          </div>
        `;
        post.visualizacoes++;
        area.appendChild(div);
      });
      salvarPosts();
    }

    function comentar(id, botao) {
      const texto = botao.previousElementSibling.value.trim();
      if (texto) {
        const post = posts.find(p => p.id === id);
        post.comentarios.push(texto);
        salvarPosts();
        exibirPosts(posts);
      }
    }

    function filtrarPorTema(tema) {
      const filtrados = posts.filter(p => p.tema === tema);
      exibirPosts(filtrados);
    }

    // Tema
    const temaAtual = localStorage.getItem("tema") || "claro";
    document.getElementById("temaSite").value = temaAtual;
    if (temaAtual === "escuro") body.classList.add("dark");

    document.getElementById("temaSite").addEventListener("change", (e) => {
      const valor = e.target.value;
      localStorage.setItem("tema", valor);
      body.classList.toggle("dark", valor === "escuro");
    });

    function abrirConfiguracoes() {
      document.getElementById("modalConfig").style.display = "block";
    }

    function fecharConfiguracoes() {
      document.getElementById("modalConfig").style.display = "none";
    }

    exibirPosts(posts);
  </script>
</body>
        </html>
