<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Fórum Anônimo</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      display: flex;
      background: #f4f4f4;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: #1e1e1e;
      color: white;
    }
    .container {
      display: flex;
      width: 100%;
    }
    .sidebar {
      width: 250px;
      background: #ddd;
      padding: 10px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      transition: background 0.3s;
    }
    body.dark .sidebar {
      background: #2c2c2c;
    }
    .sidebar input {
      width: 100%;
      padding: 5px;
      margin-bottom: 10px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      cursor: pointer;
      padding: 5px;
    }
    .sidebar li:hover {
      background: #bbb;
    }
    body.dark .sidebar li:hover {
      background: #444;
    }
    .content {
      flex: 1;
      padding: 20px;
    }
    #postForm {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 30px;
    }
    #postForm input, #postForm select, #postForm textarea {
      padding: 8px;
      font-size: 14px;
      width: 100%;
    }
    #postForm button {
      padding: 10px;
      background: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    .post {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      color: black;
    }
    body.dark .post {
      background: #2e2e2e;
      color: white;
    }
    .post-img {
      max-width: 100%;
      margin-top: 10px;
    }
    .comentario-textarea {
      width: 100%;
      margin-top: 10px;
      padding: 6px;
    }
    .views {
      font-size: 12px;
      color: gray;
    }
    .modal {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      background: white;
      padding: 20px;
      border-radius: 5px;
      display: none;
      z-index: 999;
    }
    body.dark .modal {
      background: #2e2e2e;
      color: white;
    }
    .modal label {
      display: block;
      margin: 10px 0 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <input type="text" id="search" placeholder="Pesquisar...">
      <h3 id="temasTitulo">Temas</h3>
      <ul id="temaList">
        <li onclick="filtrarPorTema('Geral')">Geral</li>
        <li onclick="filtrarPorTema('Tecnologia')">Tecnologia</li>
        <li onclick="filtrarPorTema('Música')">Música</li>
        <li onclick="filtrarPorTema('Jogos')">Jogos</li>
        <li onclick="filtrarPorTema('Notícias')">Notícias</li>
        <li onclick="filtrarPorTema('Aleatório')">Aleatório</li>
        <li onclick="filtrarPorTema('Arte')">Arte</li>
        <li onclick="filtrarPorTema('Ciência')">Ciência</li>
        <li onclick="filtrarPorTema('Esportes')">Esportes</li>
        <li onclick="filtrarPorTema('Literatura')">Literatura</li>
      </ul>
      <h3 id="acessadosTitulo">Mais acessados</h3>
      <ul id="maisAcessados"></ul>
      <hr>
      <button onclick="abrirConfiguracoes()">⚙️ Configurações</button>
    </aside>

    <main class="content">
      <h1 id="tituloPrincipal">Fórum Anônimo</h1>
      <form id="postForm">
        <input type="text" id="titulo" placeholder="Título do post" required>
        <select id="tema">
          <option>Geral</option>
          <option>Tecnologia</option>
          <option>Música</option>
          <option>Jogos</option>
          <option>Notícias</option>
          <option>Aleatório</option>
          <option>Arte</option>
          <option>Ciência</option>
          <option>Esportes</option>
          <option>Literatura</option>
        </select>
        <textarea id="conteudo" placeholder="Escreva aqui..." required></textarea>
        <input type="file" id="imagem">
        <button type="submit" id="botaoPostar">Postar</button>
      </form>
      <div id="posts"></div>
    </main>
  </div>

  <!-- Modal de configurações -->
  <div class="modal" id="modalConfig">
    <h3>Configurações</h3>
    <label for="temaSite">Tema:</label>
    <select id="temaSite">
      <option value="claro">Claro</option>
      <option value="escuro">Escuro</option>
    </select>

    <label for="idioma">Idioma:</label>
    <select id="idioma">
      <option value="pt">Português</option>
      <option value="en">English</option>
    </select>

    <br><br>
    <button onclick="fecharConfiguracoes()">Fechar</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getDatabase, ref, set, get, child, update, push } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDoGZRT9rS4KCkSP6AV99GDs2gEfdoyAVU",
      authDomain: "kill-ea075.firebaseapp.com",
      databaseURL: "https://kill-ea075-default-rtdb.firebaseio.com",
      projectId: "kill-ea075",
      storageBucket: "kill-ea075.firebasestorage.app",
      messagingSenderId: "961864950723",
      appId: "1:961864950723:web:f5f85735d0fe3eea001376"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const postsRef = ref(db, 'posts/');

    // Incrementar número de anônimos
    let contadorAnonimo = localStorage.getItem("anonID") || 1;
    if (!localStorage.getItem("anonID")) {
      localStorage.setItem("anonID", contadorAnonimo);
    }

    // Nome do anônimo
    const anonimoNome = "anônimo_" + contadorAnonimo;

    // Obter os posts do Firebase
    function obterPosts() {
      get(postsRef).then((snapshot) => {
        if (snapshot.exists()) {
          const posts = snapshot.val();
          exibirPosts(Object.values(posts));
        } else {
          console.log("Nenhum post encontrado");
        }
      }).catch((error) => {
        console.error("Erro ao ler os dados:", error);
      });
    }

    function salvarPost(post) {
      const newPostKey = push(postsRef).key;
      set(ref(db, 'posts/' + newPostKey), post);
    }

    document.getElementById("postForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const titulo = document.getElementById("titulo").value;
      const conteudo = document.getElementById("conteudo").value;
      const tema = document.getElementById("tema").value;
      const imagemInput = document.getElementById("imagem");
      const imagemURL = imagemInput.files[0] ? URL.createObjectURL(imagemInput.files[0]) : null;

      // Incrementar contador de anônimos
      localStorage.setItem("anonID", ++contadorAnonimo);
      const novoAnonimo = "anônimo_" + contadorAnonimo;

      const novoPost = {
        id: Date.now(),
        titulo,
        conteudo,
        autor: novoAnonimo,
        tema,
        imagem: imagemURL,
        comentarios: [],
        visualizacoes: 0
      };
      
      salvarPost(novoPost);
      e.target.reset();
      obterPosts();
    });

    function exibirPosts(lista) {
      const area = document.getElementById("posts");
      area.innerHTML = "";
      lista.forEach(post => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <h2>${post.titulo}</h2>
          <p><strong>${post.autor}</strong> - <em>${post.tema}</em></p>
          <p>${post.conteudo}</p>
          ${post.imagem ? `<img src="${post.imagem}" class="post-img">` : ""}
          <p class="views">Visualizações: ${post.visualizacoes}</p>
          <textarea placeholder="Comentar..." class="comentario-textarea"></textarea>
          <button onclick="comentar(${post.id}, this)">Comentar</button>
          <div class="comentarios">
            ${post.comentarios.map(c => `<p>${c}</p>`).join("")}
          </div>
        `;
        post.visualizacoes++;
        area.appendChild(div);
      });
    }

    function comentar(id, botao) {
      const texto = botao.previousElementSibling.value.trim();
      if (texto) {
        // Comentar no Firebase
        const postRef = ref(db, 'posts/' + id);
        get(postRef).then((snapshot) => {
          if (snapshot.exists()) {
            const post = snapshot.val();
            post.comentarios.push(texto);
            update(postRef, { comentarios: post.comentarios });
            obterPosts();
          }
        });
      }
    }

    function filtrarPorTema(tema) {
      const filtrados = posts.filter(p => p.tema === tema);
      exibirPosts(filtrados);
    }

    // Inicializando os posts
    obterPosts();
  </script>
</body>
        </html>
