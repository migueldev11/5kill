<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>4you - Fórum Anônimo</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #fdf6e3;
      color: #000;
      margin: 0;
      padding: 0;
    }
    header {
      background: #004466;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      border-bottom: 5px double #999;
    }
    .top-bar {
      background: #ddd;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }
    .top-bar input {
      padding: 5px;
      font-size: 14px;
      width: 200px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      margin: 20px;
    }
    .sidebar {
      width: 200px;
      padding: 10px;
      background: #e0e0e0;
      margin-right: 20px;
      border: 1px solid #999;
    }
    .content {
      flex: 1;
    }
    .post-form input, .post-form textarea, .post-form select {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #666;
      background: #fff;
    }
    .post-form button {
      padding: 10px;
      background: #004466;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    .post {
      background: #fff;
      border: 1px solid #666;
      padding: 10px;
      margin-bottom: 15px;
    }
    .post h3 {
      margin: 0 0 10px;
    }
    .comment-box {
      margin-top: 10px;
    }
    .comment-box textarea {
      width: 100%;
      padding: 5px;
    }
    .comment-box button {
      margin-top: 5px;
      background: #888;
      color: #fff;
      border: none;
      padding: 5px;
      cursor: pointer;
    }
    .comment {
      background: #f0f0f0;
      margin-top: 5px;
      padding: 5px;
    }
  </style>
</head>
<body>
  <header>4you - Fórum Anônimo</header>
  <div class="top-bar">
    Nome de usuário: <input type="text" id="usernameInput" placeholder="Anônimo">
  </div>
  <div class="container">
    <div class="sidebar">
      <strong>Temas:</strong>
      <ul>
        <li><a href="#" onclick="filtrarTema('Geral')">Geral</a></li>
        <li><a href="#" onclick="filtrarTema('Tecnologia')">Tecnologia</a></li>
        <li><a href="#" onclick="filtrarTema('Memes')">Memes</a></li>
        <li><a href="#" onclick="filtrarTema('Aleatório')">Aleatório</a></li>
      </ul>
    </div>
    <div class="content">
      <form class="post-form" id="postForm">
        <input type="text" id="titulo" placeholder="Título" required>
        <select id="tema">
          <option value="Geral">Geral</option>
          <option value="Tecnologia">Tecnologia</option>
          <option value="Memes">Memes</option>
          <option value="Aleatório">Aleatório</option>
        </select>
        <textarea id="mensagem" placeholder="Escreva sua mensagem..." required></textarea>
        <button type="submit">Postar</button>
      </form>
      <div id="posts"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoGZRT9rS4KCkSP6AV99GDs2gEfdoyAVU",
      authDomain: "kill-ea075.firebaseapp.com",
      databaseURL: "https://kill-ea075-default-rtdb.firebaseio.com",
      projectId: "kill-ea075",
      storageBucket: "kill-ea075.appspot.com",
      messagingSenderId: "961864950723",
      appId: "1:961864950723:web:f5f85735d0fe3eea001376"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const postsRef = ref(db, "posts");

    const usernameInput = document.getElementById("usernameInput");
    const savedUser = localStorage.getItem("username");
    if (savedUser) usernameInput.value = savedUser;
    usernameInput.addEventListener("change", () => {
      localStorage.setItem("username", usernameInput.value.trim() || "Anônimo");
    });

    document.getElementById("postForm").addEventListener("submit", e => {
      e.preventDefault();
      const titulo = document.getElementById("titulo").value;
      const tema = document.getElementById("tema").value;
      const mensagem = document.getElementById("mensagem").value;
      const autor = usernameInput.value.trim() || "Anônimo";

      const post = {
        titulo,
        tema,
        mensagem,
        autor,
        comentarios: [],
        timestamp: Date.now()
      };
      push(postsRef, post);
      e.target.reset();
    });

    function renderizarPost(id, post) {
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <h3>${post.titulo}</h3>
        <p><strong>Tema:</strong> ${post.tema} | <strong>Autor:</strong> ${post.autor}</p>
        <p>${post.mensagem}</p>
        <div class="comentarios" id="comentarios-${id}">
          ${post.comentarios?.map(c => `<div class="comment">${c}</div>`).join("") || ""}
        </div>
        <div class="comment-box">
          <textarea placeholder="Comentar..." id="input-${id}"></textarea>
          <button onclick="comentar('${id}')">Comentar</button>
        </div>
      `;
      return div;
    }

    window.comentar = function(id) {
      const input = document.getElementById(`input-${id}`);
      const texto = input.value.trim();
      if (!texto) return;

      const nome = localStorage.getItem("username") || "Anônimo";
      const comentario = `${nome}: ${texto}`;

      const comentariosRef = ref(db, `posts/${id}/comentarios`);
      onValue(comentariosRef, snapshot => {
        const comentarios = snapshot.val() || [];
        comentarios.push(comentario);
        set(comentariosRef, comentarios);
      }, {
        onlyOnce: true
      });

      input.value = "";
    };

    function carregarPosts() {
      onValue(postsRef, snapshot => {
        const area = document.getElementById("posts");
        area.innerHTML = "";
        const data = snapshot.val();
        if (data) {
          const keys = Object.keys(data).sort((a, b) => data[b].timestamp - data[a].timestamp);
          keys.forEach(id => {
            area.appendChild(renderizarPost(id, data[id]));
          });
        }
      });
    }

    let temaAtual = null;
    function filtrarTema(tema) {
      temaAtual = tema;
      onValue(postsRef, snapshot => {
        const area = document.getElementById("posts");
        area.innerHTML = "";
        const data = snapshot.val();
        if (data) {
          const keys = Object.keys(data).filter(k => data[k].tema === temaAtual)
            .sort((a, b) => data[b].timestamp - data[a].timestamp);
          keys.forEach(id => {
            area.appendChild(renderizarPost(id, data[id]));
          });
        }
      });
    }

    carregarPosts();
  </script>
</body>
</html>
